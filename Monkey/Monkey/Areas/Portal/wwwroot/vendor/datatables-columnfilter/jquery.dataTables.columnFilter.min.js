(function(n){n.fn.columnFilter=function(t){function p(n,t,r,u,f){var h,e,o,c,l,s;if(typeof t=="undefined")return[];for(typeof r=="undefined"&&(r=!0),typeof u=="undefined"&&(u=!0),typeof f=="undefined"&&(f=!0),h=u==!0?n.aiDisplay:n.aiDisplayMaster,e=[],o=0,c=h.length;o<c;o++)if(l=h[o],s=i.fnGetData(l,t),f==!0&&s.length==0)continue;else if(r==!0&&jQuery.inArray(s,e)>-1)continue;else e.push(s);return e.sort()}function h(n){return f.bUseColVis?n:i.fnSettings().oApi._fnVisibleToColumnIndex(i.fnSettings(),n)}function w(t,i,o,c,l,v,y,p){var d="dandelion_column_filter dandelion_text_filter "+p,w,k;c&&(d="dandelion_column_filter dandelion_number_filter "+p);e=e.replace(/(^\s*)|(\s*$)/g,"");var b=t.fnSettings().aoPreSearchCols[r].sSearch,g="search_init ",nt=e;b!=""&&b!="^"&&(nt=c&&b.charAt(0)=="^"?b.substr(1):b,g="");w=n('<input type="text" class="'+g+d+'" value="'+nt+'"/>');v!=undefined&&v!=-1&&w.attr("maxlength",v);y!=undefined&&y!=""&&w.attr("data-column-name",y);u.html(w);c?u.wrapInner('<span class="filter_column filter_number" />'):u.wrapInner('<span class="filter_column filter_text" />');a[r]=e;k=r;f.sFilteringTrigger=="immediate"&&(c&&!t.fnSettings().oFeatures.bServerSide?w.keyup(function(){t.fnFilter("^"+this.value,h(k),!0,!1);s()}):w.keyup(function(){var f,r,u;if(t.fnSettings().oFeatures.bServerSide&&l!=0){if(f=t.fnSettings().aoPreSearchCols[k].sSearch,r=n(this).data("dt-iLastFilterLength"),typeof r=="undefined"&&(r=0),u=this.value.length,Math.abs(u-r)<l)return;n(this).data("dt-iLastFilterLength",u)}t.fnFilter(this.value,h(k),i,o);s()}));w.focus(function(){n(this).hasClass("search_init")&&(n(this).removeClass("search_init"),this.value="")});w.blur(function(){this.value==""&&(n(this).addClass("search_init"),this.value=a[k])})}function d(t,i,e){var w="dandelion_column_filter dandelion_number_range_filter "+e,o,a,l,y,p;u.html(v(0));o=t.attr("id")+"_range_from_"+r;a=n('<input type="text" class="'+w+'" id="'+o+'" rel="'+r+'"/>');i!=undefined&&i!=""&&a.attr("data-column-name",i);u.append(a);u.append(v(1));l=t.attr("id")+"_range_to_"+r;y=n('<input type="text" class="'+w+'" id="'+l+'" rel="'+r+'"/>');i!=undefined&&i!=""&&y.attr("data-column-name",i);u.append(y);u.append(v(2));u.wrapInner('<span class="filter_column filter_number_range" />');p=r;c.push(r);t.dataTableExt.afnFiltering.push(function(n,i){if(t.attr("id")!=n.sTableId||document.getElementById(o)==null)return!0;var r=document.getElementById(o).value*1,u=document.getElementById(l).value*1,f=i[h(p)]=="-"?0:i[h(p)]*1;return r==""&&u==""?!0:r==""&&f<=u||r<=f&&""==u||r<=f&&f<=u?!0:!1});f.sFilteringTrigger=="immediate"&&n("#"+o+",#"+l,u).keyup(function(){var n=document.getElementById(o).value*1,i=document.getElementById(l).value*1;n!=0&&i!=0&&n>i||(t.fnDraw(),s())})}function g(t,i,e,l){var y=o.split(/[}{]/),k="dandelion_column_filter dandelion_date_range_filter "+e,w,a,b,v,p;for(u.html(""),w=t.attr("id")+"_range_from_"+r,a=n('<input type="text" class="'+k+'" id="'+w+'" rel="'+r+'"/>'),i!=undefined&&i!=""&&a.attr("data-column-name",i),a.datepicker({format:l,autoclose:!0}),b=t.attr("id")+"_range_to_"+r,v=n('<input type="text" class="'+k+'" id="'+b+'" rel="'+r+'"/>'),i!=undefined&&i!=""&&v.attr("data-column-name",i),ti=0;ti<y.length;ti++)y[ti]==f.sDateFromToken?u.append(a):y[ti]==f.sDateToToken?u.append(v):u.append(y[ti]);u.wrapInner('<span class="filter_column filter_date_range" />');v.datepicker({format:l,autoclose:!0});p=r;c.push(r);t.dataTableExt.afnFiltering.push(function(i,r){var f,e,u;if(t.attr("id")!=i.sTableId||(f=a.datepicker("getDate"),e=v.datepicker("getDate"),f==null&&e==null))return!0;u=null;try{if(r[h(p)]==null||r[h(p)]=="")return!1;u=n.datepicker.parseDate(n.datepicker.regional[""].dateFormat,r[h(p)])}catch(o){return!1}return u==null?!1:f==null&&u<=e?!0:f<=u&&e==null||f<=u&&u<=e?!0:!1});f.sFilteringTrigger=="immediate"&&n("#"+w+",#"+b,u).change(function(){t.fnDraw();s()})}function b(t,i,u,e,o,h,c,l,a){var d,y,w,k;i==null&&(i=p(t.fnSettings(),u,!0,!1,!0));d=u;y=t.fnSettings().aoPreSearchCols[r].sSearch;(y==null||y=="")&&(y=c);for(var g="dandelion_column_filter dandelion_select_filter "+a,b='<select class="search_init '+g+'"><option value="" class="search_init">'+o+"<\/option>",v=0,nt=i.length,v=0;v<nt;v++)typeof i[v]!="object"?(w="",(escape(i[v])==y||escape(i[v])==escape(y))&&(w="selected "),b+="<option "+w+' value="'+escape(i[v])+'">'+i[v]+"<\/option>"):(w="",h?(i[v].value==y&&(w="selected "),b+="<option "+w+'value="'+i[v].value+'">'+i[v].label+"<\/option>"):(escape(i[v].value)==y&&(w="selected "),b+="<option "+w+'value="'+escape(i[v].value)+'">'+i[v].label+"<\/option>"));k=n(b+"<\/select>");l!=undefined&&l!=""&&k.attr("data-column-name",l);e.html(k);e.wrapInner('<span class="filter_column filter_select" />');k.change(function(){n(this).val()!=""?n(this).removeClass("search_init"):n(this).addClass("search_init");f.sFilteringTrigger=="immediate"&&(h?t.fnFilter(n(this).val(),u,h):t.fnFilter(unescape(n(this).val()),u),s())});y!=null&&y!=""&&t.fnFilter(unescape(y),u)}function nt(n,t,i,f,o,s){var c=n.fnSettings();t!=null||c.sAjaxSource==""||c.oFeatures.bServerSide||c.aoDrawCallback.push({fn:function(t,r,u){return function(){if(c.iDraw==2&&c.sAjaxSource!=null&&c.sAjaxSource!=""&&!c.oFeatures.bServerSide)return b(n,null,h(t),r,u,i,f,o,s)}}(r,u,e),sName:"column_filter_"+r});b(n,t,h(r),u,e,i,f,o,s)}function tt(t){for(var h=r,s='<div class="dropdown dandelion_column_filter dandelion_select_filter"><a class="dropdown-toggle" data-toggle="dropdown" href="#">'+e+'<b class="caret"><\/b><\/a><ul class="dropdown-menu" role="menu"><li data-value=""><a>Show All<\/a><\/li>',c=t.length,o,f=0;f<c;f++)s+='<li data-value="'+t[f]+'"><a>'+t[f]+"<\/a><\/li>";o=n(s+"<\/ul><\/div>");u.html(o);u.wrapInner('<span class="filterColumn filter_select" />');o.find("li").click(function(){i.fnFilter(n(this).data("value"),h)})}function it(t,i){var w,k,nt,d,rt;i==null&&(i=p(t.fnSettings(),r,!0,!0,!0));var g=r,c="",o,v=i.length,h=e.replace("%","Perc").replace("&","AND").replace("$","DOL").replace("ï¿½","STERL").replace("@","AT").replace(/\s/g,"_");h=h.replace(/[^a-zA-Z 0-9]+/g,"");w=e;(f.sFilterButtonText!=null||f.sFilterButtonText!=undefined)&&(w=f.sFilterButtonText);var b=12,l=Math.floor(v/b);v%b>0&&(l=l+1);k=100/l-2;nt=10*l;l==1&&(k=20);var tt='<div style="float:left; min-width: '+k+'%; " >',it=t.attr("id")+h,y="chkBtnOpen"+it,a=it+"-flt-toggle";for(c+='<button id="'+y+'" class="checkbox_filter" > '+w+"<\/button>",c+='<div id="'+a+'" title="'+e+'" class="toggle-check ui-widget-content ui-corner-all"  style="width: '+nt+'%; " >',c+=tt,o=0;o<v;o++)o%b==0&&o!=0&&(c+="<\/div>"+tt),c+='<input class="search_init checkbox_filter" type="checkbox" id= "'+i[o]+'" name= "'+h+'" value="'+i[o]+'" >'+i[o]+"<br/>",d=n(c),u.html(d),u.wrapInner('<span class="filter_column filter_checkbox" />'),d.change(function(){var r="",f="|",e=n('input:checkbox[name="'+h+'"]:checked').size(),u;for(n('input:checkbox[name="'+h+'"]:checked').each(function(t){(t==0&&e==1||t!=0&&t==e-1)&&(f="");r=r.replace(/^\s+|\s+$/g,"");r=r+n(this).val()+f;f="|"}),u=0;u<v;u++)r!=""?n("#"+i[u]).removeClass("search_init"):n("#"+i[u]).addClass("search_init");t.fnFilter(r,g,!0,!1);s()});n("#"+y).button();n("#"+a).dialog({autoOpen:!1,hide:"blind",buttons:[{text:"Reset",click:function(){return n('input:checkbox[name="'+h+'"]:checked').each(function(){n(this).attr("checked",!1);n(this).addClass("search_init")}),t.fnFilter("",g,!0,!1),s(),!1}},{text:"Close",click:function(){n(this).dialog("close")}}]});n("#"+y).click(function(){n("#"+a).dialog("open");var t=n(this);return n("#"+a).dialog("widget").position({my:"top",at:"bottom",of:t}),!1});rt=s;s=function(){var t=n("#"+y);n("#"+a).dialog("widget").position({my:"top",at:"bottom",of:t});rt()}}function v(n){switch(n){case 0:return o.substring(0,o.indexOf("{from}"));case 1:return o.substring(o.indexOf("{from}")+6,o.indexOf("{to}"));default:return o.substring(o.indexOf("{to}")+4)}}var a,r,e,u,o="From {from} to {to}",y=[],c=[],l=null,s=function(){},i=this,f=n.extend({sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}",sDateFromToken:"from",sDateToToken:"to",sFilteringTrigger:"immediate",sDateFormat:"yyyy-mm-dd"},t);return this.each(function(){var s,b,h;if(i.fnSettings().oFeatures.bFilter){a=[];var t=i.fnSettings().aoFooter[0],v=i.fnSettings().nTFoot,p="tr";for(f.sPlaceHolder=="head:after"?(s=n("tr:first",i.fnSettings().nTHead).detach(),i.fnSettings().bSortCellsTop?(s.prependTo(n(i.fnSettings().nTHead)),t=i.fnSettings().aoHeader[1]):(s.appendTo(n(i.fnSettings().nTHead)),t=i.fnSettings().aoHeader[0]),p="tr:last",v=i.fnSettings().nTHead):f.sPlaceHolder=="head:before"?(i.fnSettings().bSortCellsTop?(s=n("tr:first",i.fnSettings().nTHead).detach(),s.appendTo(n(i.fnSettings().nTHead)),t=i.fnSettings().aoHeader[1]):t=i.fnSettings().aoHeader[0],p="tr:first",v=i.fnSettings().nTHead):f.sPlaceHolder=="none"&&(t=i.fnSettings().bSortCellsTop?i.fnSettings().aoHeader[1]:i.fnSettings().aoHeader[0]),n(t).each(function(t){r=t;var s={type:"text",bRegex:!1,bSmart:!0,iMaxLenght:-1,iFilterLength:0};if(f.aoColumns!=null){if(f.aoColumns.length<r||f.aoColumns[r]==null)return;s=f.aoColumns[r]}if(e=n(n(this)[0].cell).text(),f.sPlaceHolder!="none"&&s.type=="null"&&n(n(this)[0].cell).text(""),s.sSelector==null?u=n(n(this)[0].cell):(u=n(s.sSelector),u.length==0&&(u=n(n(this)[0].cell))),s!=null){o=s.sRangeFormat!=null?s.sRangeFormat:f.sRangeFormat;switch(s.type){case"null":break;case"number":w(i,!0,!1,!0,s.iFilterLength,s.iMaxLenght,s.sName,s.sClass);break;case"select":s.bRegex!=!0&&(s.bRegex=!1);nt(i,s.values,s.bRegex,s.selected,s.sName,s.sClass);break;case"number-range":d(i,s.sName,s.sClass);break;case"date-range":g(i,s.sName,s.sClass,s.sDateFormat);break;case"checkbox":it(i,s.values);break;case"twitter-dropdown":case"dropdown":tt(s.values);break;case"text":default:bRegex=s.bRegex==null?!1:s.bRegex;bSmart=s.bSmart==null?!1:s.bSmart;w(i,bRegex,bSmart,!1,s.iFilterLength,s.iMaxLenght,s.sName,s.sClass)}}}),j=0;j<c.length;j++)b=function(){var t=i.attr("id");return n("#"+t+"_range_from_"+c[j]).val()+f.sRangeSeparator+n("#"+t+"_range_to_"+c[j]).val()},y.push(b);i.fnSettings().oFeatures.bServerSide&&(h=i.fnSettings().fnServerData,i.fnSettings().fnServerData=function(t,r,u){for(j=0;j<c.length;j++){var e=c[j];for(k=0;k<r.length;k++)r[k].name=="sSearch_"+e&&(r[k].value=y[j]())}r.push({name:"sRangeSeparator",value:f.sRangeSeparator});h!=null?f.iFilteringDelay!=0&&(l!=null&&window.clearTimeout(l),l=window.setTimeout(function(){try{h(t,r,u,i.fnSettings())}catch(n){h(t,r,u)}},f.iFilteringDelay)):f.iFilteringDelay!=0&&(l!=null&&window.clearTimeout(l),l=window.setTimeout(function(){n.getJSON(t,r,function(n){u(n)})},f.iFilteringDelay))})}})}})(jQuery);